# Implementation Plan: SearXNG MCP Server (v2 - Aligned)

**Branch**: `001-searxng-mcp` | **Date**: 2025-09-12 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-searxng-mcp/spec.md`

## Summary
This plan outlines the implementation of a FastAPI-based MCP server that acts as a proxy to a SearXNG instance. It will expose a simple REST API for searching, allowing users to query SearXNG and receive results in a structured JSON format. The implementation will strictly follow a Test-Driven Development (TDD) approach and correctly utilize the `fastapi-mcp` library to expose endpoints as AI tools.

## Technical Context
**Language/Version**: Python 3.11
**Primary Dependencies**: FastAPI, httpx, fastapi-mcp
**Storage**: N/A
**Testing**: pytest
**Target Platform**: Linux server (Docker container)
**Project Type**: Single project
**Performance Goals**: [NEEDS CLARIFICATION: e.g., p95 latency < 500ms for passthrough requests]
**Constraints**: Must be able to connect to a configurable SearXNG instance URL via an environment variable.
**Scale/Scope**: Initial version for a small number of users.

## Constitution Check
*GATE: The constitution file at `.specify/memory/constitution.md` is currently a template. The checks are based on general best practices and the `FastAPImcp_guide.md`.*

**Simplicity**: PASS
- Projects: 1 (API)
- Using framework directly: Yes
- Single data model: Yes
- Avoiding patterns: Yes

**Architecture**: PASS
- The feature will be a self-contained service following the established 3-tier structure.

**Testing (NON-NEGOTIABLE)**: PASS (planned)
- TDD will be strictly followed.

**Observability**: PASS (planned)
- Structured logging will be included.

**Versioning**: PASS (planned)
- Versioning will follow MAJOR.MINOR.BUILD.

## Project Structure

### Documentation (this feature)
```
specs/001-searxng-mcp/
├── plan.md              # This file
├── research.md          # Completed
├── data-model.md        # Completed
├── quickstart.md        # Completed
├── contracts/           # Completed
│   └── api.yaml
└── tasks.md             # To be generated by /tasks command
```

### Source Code (repository root)
```
# Per FastAPImcp_guide.md
src/
├── schemas.py
├── services/
│   └── searxng_service.py
├── routers/
│   └── searxng_router.py
└── main.py

tests/
├── contract/
└── integration/

Dockerfile
docker-compose.yml
```

**Structure Decision**: Adhere to `FastAPImcp_guide.md` conventions.

## Phase 0: Outline & Research
Completed. See `research.md` for details on SearXNG parameter selection.

## Phase 1: Design & Contracts
Completed. See `data-model.md`, `contracts/api.yaml`, and `quickstart.md`.

## Phase 2: Task Planning Approach (TDD Compliant & Aligned)
*This section describes what the /tasks command will do, following a strict TDD order and incorporating all project requirements.*

**Ordering Strategy**:

1.  **Foundation (Project Setup)**:
    - Task: Set up dependency management (`requirements.txt`) and linting (`ruff`).
    - Task: Create `Dockerfile` and `docker-compose.yml`.
    - Task: Create Pydantic models (`schemas.py`) and configuration (`config.py`).

2.  **Write Failing Tests (RED)**:
    - Task: Write a failing integration test for the primary success scenario.
    - Task: Write a failing contract test to validate the API schema.

3.  **Implement API Structure (GREEN for Contract Test)**:
    - Task: Implement the skeleton service, the router (including `operation_id` and query parameters), and the main app file.

4.  **Implement Business Logic (GREEN for Integration Test)**:
    - Task: Implement the actual service logic to call the SearXNG API.

5.  **Integrate Core Library (`fastapi-mcp`)**:
    - Task: Mount the `fastapi-mcp` server to the FastAPI application to expose the endpoints as AI tools.

6.  **Add Edge Case Tests (RED -> GREEN)**:
    - Task: Write failing tests for specific edge cases (e.g., external API unavailable) and then implement the necessary error handling.

7.  **Refactor & Polish**:
    - Task: Review and refactor the codebase for quality and clarity.
    - Task: Perform a final review of all docstrings to ensure they meet the guide's standards for auto-generated AI tool documentation.

## Progress Tracking

**Phase Status**:
- [x] Phase 0: Research complete (/plan command)
- [x] Phase 1: Design complete (/plan command)
- [x] Phase 2: Task planning complete (/plan command - describe approach only)
- [x] Phase 3: Tasks generated (/tasks command)
- [ ] Phase 4: Implementation complete
- [ ] Phase 5: Validation passed

**Gate Status**:
- [x] Initial Constitution Check: PASS
- [x] Post-Design Constitution Check: PASS
- [x] All NEEDS CLARIFICATION resolved
- [ ] Complexity deviations documented