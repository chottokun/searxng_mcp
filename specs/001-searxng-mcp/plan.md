# Implementation Plan: SearXNG MCP Server

**Branch**: `001-searxng-mcp` | **Date**: 2025-09-12 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-searxng-mcp/spec.md`

## Summary
This plan outlines the implementation of a FastAPI-based MCP server that acts as a proxy to a SearXNG instance. It will expose a simple REST API for searching, allowing users to query SearXNG and receive results in a structured JSON format. The implementation will strictly follow a Test-Driven Development (TDD) approach.

## Technical Context
**Language/Version**: Python 3.11
**Primary Dependencies**: FastAPI, httpx, fastapi-mcp
**Storage**: N/A
**Testing**: pytest
**Target Platform**: Linux server (Docker container)
**Project Type**: Single project
**Performance Goals**: [NEEDS CLARIFICATION: e.g., p95 latency < 500ms for passthrough requests]
**Constraints**: Must be able to connect to a configurable SearXNG instance URL via an environment variable.
**Scale/Scope**: Initial version for a small number of users.

## Constitution Check
*GATE: The constitution file at `.specify/memory/constitution.md` is currently a template. The checks are based on general best practices and the `FastAPImcp_guide.md`.*

**Simplicity**: PASS
- Projects: 1 (API)
- Using framework directly: Yes
- Single data model: Yes
- Avoiding patterns: Yes

**Architecture**: PASS
- The feature will be a self-contained service following the established 3-tier structure.

**Testing (NON-NEGOTIABLE)**: PASS (planned)
- TDD will be strictly followed.

**Observability**: PASS (planned)
- Structured logging will be included.

**Versioning**: PASS (planned)
- Versioning will follow MAJOR.MINOR.BUILD.

## Project Structure

### Documentation (this feature)
```
specs/001-searxng-mcp/
├── plan.md              # This file
├── research.md          # Completed
├── data-model.md        # Completed
├── quickstart.md        # Completed
├── contracts/           # Completed
│   └── api.yaml
└── tasks.md             # To be generated by /tasks command
```

### Source Code (repository root)
```
# Per FastAPImcp_guide.md
src/
├── schemas.py
├── services/
│   └── searxng_service.py
├── routers/
│   └── searxng_router.py
└── main.py

tests/
├── contract/
└── integration/

Dockerfile
docker-compose.yml
```

**Structure Decision**: Adhere to `FastAPImcp_guide.md` conventions.

## Phase 0: Outline & Research
Completed. See `research.md` for details on SearXNG parameter selection.

## Phase 1: Design & Contracts
Completed. See `data-model.md`, `contracts/api.yaml`, and `quickstart.md`.

## Phase 2: Task Planning Approach (TDD Compliant)
*This section describes what the /tasks command will do, following a strict TDD order.*

**Ordering Strategy**:

1.  **Foundation (No Tests First)**:
    - Task: Create `Dockerfile` and `docker-compose.yml`.
    - Task: Create Pydantic models in `src/schemas.py`.
    - Task: Implement configuration module to read `SEARXNG_URL`.

2.  **Write Failing Integration Test (RED)**:
    - Task: In `tests/integration/`, write a test for the primary user story (a successful search). This test will call the endpoint and assert a valid response structure. It MUST fail because no endpoint or logic exists.

3.  **Write Failing Contract Test (RED)**:
    - Task: In `tests/contract/`, write a test to validate the `/search` endpoint's request/response schema against `contracts/api.yaml`. This MUST fail as the endpoint does not exist.

4.  **Implement API Structure (GREEN for Contract Test)**:
    - Task: Implement the router in `src/routers/searxng_router.py`.
    - Task: Implement a skeleton `SearxngService` that returns a hardcoded, schema-valid response.
    - Task: Update `src/main.py` to include the router.
    - *Verification: The Contract Test should now pass. The Integration Test MUST still fail.*

5.  **Implement Business Logic (GREEN for Integration Test)**:
    - Task: Implement the real logic in `SearxngService` to connect to the SearXNG API and return actual results.
    - *Verification: The Integration Test should now pass.*

6.  **Add Edge Case Tests (RED -> GREEN)**:
    - Task: Add integration tests for specific edge cases, such as when SearXNG is unavailable or returns no results. Write the failing test first, then add the necessary error handling in the service to make it pass.

7.  **Refactor**:
    - Task: Review and refactor the implementation for clarity, efficiency, and to remove any hardcoded values, ensuring all tests still pass.

## Progress Tracking

**Phase Status**:
- [x] Phase 0: Research complete (/plan command)
- [x] Phase 1: Design complete (/plan command)
- [x] Phase 2: Task planning complete (/plan command - describe approach only)
- [ ] Phase 3: Tasks generated (/tasks command)
- [ ] Phase 4: Implementation complete
- [ ] Phase 5: Validation passed

**Gate Status**:
- [x] Initial Constitution Check: PASS
- [x] Post-Design Constitution Check: PASS
- [x] All NEEDS CLARIFICATION resolved
- [ ] Complexity deviations documented
